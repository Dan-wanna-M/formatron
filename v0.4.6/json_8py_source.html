<!-- HTML header for doxygen 1.11.0-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.11.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Formatron: src/formatron/formats/json.py Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Formatron<span id="projectnumber">&#160;v0.4.6</span>
     <!-- Version Selector -->
     <select id="versionSelector" onchange="location = this.value;">
       <option value="../v0.4.6/index.html" selected>v0.4.6</option>
<option value="../v0.4.5/index.html" >v0.4.5</option>
<option value="../v0.4.4/index.html" >v0.4.4</option>
<option value="../v0.4.3/index.html" >v0.4.3</option>
<option value="../v0.4.2/index.html" >v0.4.2</option>
<option value="../v0.4.1/index.html" >v0.4.1</option>
<option value="../v0.4.0/index.html" >v0.4.0</option>
<option value="../v0.3.4/index.html" >v0.3.4</option>
<option value="../v0.3.3/index.html" >v0.3.3</option>
<option value="../v0.3.2/index.html" >v0.3.2</option>
<option value="../v0.3.1/index.html" >v0.3.1</option>
<option value="../v0.3.0/index.html" >v0.3.0</option>
<option value="../v0.2.0/index.html" >v0.2.0</option>
<option value="../v0.1.3/index.html" >v0.1.3</option>
<option value="../v0.1.2/index.html" >v0.1.2</option>
<option value="../v0.1.1/index.html" >v0.1.1</option>
     </select>
   </div>
   <div id="projectbrief">Formatron empowers everyone to control the output format of language models with minimal overhead.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.11.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('json_8py_source.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">json.py</div></div>
</div><!--header-->
<div class="contents">
<a href="json_8py.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno"><a class="line" href="namespaceformatron_1_1formats_1_1json.html">    1</a></span><span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="stringliteral">The module defines the `JsonExtractor` class, which is used to extract data from a string in JSON format.</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="keyword">import</span> collections</div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="keyword">import</span> decimal</div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="keyword">import</span> types</div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="keyword">import</span> typing</div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span> </div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="keyword">from</span> frozendict <span class="keyword">import</span> frozendict</div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span> </div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="keyword">from</span> formatron <span class="keyword">import</span> extractor, schemas</div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span> </div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span>__all__ = [<span class="stringliteral">&quot;JsonExtractor&quot;</span>]</div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span> </div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span>SPACE_NONTERMINAL = <span class="stringliteral">&quot;[ \t\n\r]*&quot;</span></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno"><a class="line" href="namespaceformatron_1_1formats_1_1json.html#af32c4b136b54f0356b017d6a319bb53d">   16</a></span> </div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span>GRAMMAR_HEADER = rf<span class="stringliteral">&quot;&quot;&quot;integer ::= #&quot;-?(0|[1-9][0-9]*)&quot;;</span></div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno"><a class="line" href="namespaceformatron_1_1formats_1_1json.html#ac81c86f8a6384cf3b11c47ddf2049ca7">   18</a></span><span class="stringliteral">number ::= #&quot;-?(0|[1-9][0-9]*)(\\.[0-9]+)?([eE][+-]?[0-9]+)?&quot;;</span></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="stringliteral">string ::= #&#39;&quot;([^\\\\&quot;\u0000-\u001f]|\\\\[&quot;\\\\bfnrt/]|\\\\u[0-9A-Fa-f]{{4}})*&quot;&#39;;</span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="stringliteral">boolean ::= &quot;true&quot;|&quot;false&quot;;</span></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="stringliteral">null ::= &quot;null&quot;;</span></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="stringliteral">array ::= array_begin (json_value (comma json_value)*)? array_end;</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="stringliteral">object ::= object_begin (string colon json_value (comma string colon json_value)*)? object_end;</span></div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span><span class="stringliteral">json_value ::= number|string|boolean|null|array|object;</span></div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span><span class="stringliteral">comma ::= #&quot;{SPACE_NONTERMINAL},{SPACE_NONTERMINAL}&quot;;</span></div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span><span class="stringliteral">colon ::= #&quot;{SPACE_NONTERMINAL}:{SPACE_NONTERMINAL}&quot;;</span></div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span><span class="stringliteral">object_begin ::= #&quot;\\{{{SPACE_NONTERMINAL}&quot;;</span></div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span><span class="stringliteral">object_end ::= #&quot;{SPACE_NONTERMINAL}\\}}&quot;;</span></div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span><span class="stringliteral">array_begin ::= #&quot;\\[{SPACE_NONTERMINAL}&quot;;</span></div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span><span class="stringliteral">array_end ::= #&quot;{SPACE_NONTERMINAL}\\]&quot;;</span></div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span><span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span>_type_to_nonterminals = []</div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span> </div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span> </div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span><span class="keyword">def </span><a class="code hl_function" href="namespaceformatron_1_1formats_1_1json.html#a55ae1cd2ef251d160e872a0c49e7ba7a">register_generate_nonterminal_def</a>(</div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno"><a class="line" href="namespaceformatron_1_1formats_1_1json.html#a003a1dac95634ac70f86d51e768945a4">   36</a></span>        generate_nonterminal_def: typing.Callable[</div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span>            [typing.Type, str],</div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span>            typing.Optional[typing.Tuple[str,</div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span>                                         typing.List[typing.Tuple[typing.Type, str]]]]]) -&gt; <span class="keywordtype">None</span>:</div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span><span class="stringliteral">    Register a callable to generate nonterminal definition from a type.</span></div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span><span class="stringliteral">    The callable returns (nonterminal_definition, [(sub_type, sub_nonterminal), ...])</span></div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span><span class="stringliteral">    if the type is supported by this callable, otherwise None.</span></div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span><span class="stringliteral">    [(sub_type, sub_nonterminal), ...] are the types and nonterminals used in nonterminal_definition that may need</span></div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span><span class="stringliteral">    to be generated in the grammar too.</span></div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span><span class="stringliteral">    Args:</span></div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span><span class="stringliteral">        generate_nonterminal_def: A callable to generate nonterminal definition from a type.</span></div>
<div class="foldopen" id="foldopen00049" data-start="" data-end="">
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno"><a class="line" href="namespaceformatron_1_1formats_1_1json.html#a55ae1cd2ef251d160e872a0c49e7ba7a">   49</a></span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span>    _type_to_nonterminals.append(generate_nonterminal_def)</div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span> </div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span> </div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span><span class="keyword">def </span><a class="code hl_function" href="namespaceformatron_1_1formats_1_1json.html#a311b750cba3838aee622b9809888f051">_register_all_predefined_types</a>():</div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span>    <span class="keyword">def </span>schema(current: typing.Type, nonterminal: str):</div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span>        <span class="keywordflow">if</span> isinstance(current, type) <span class="keywordflow">and</span> <span class="keywordflow">not</span> isinstance(current, types.GenericAlias) \</div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span>                <span class="keywordflow">and</span> issubclass(current, <a class="code hl_class" href="classformatron_1_1schemas_1_1schema_1_1Schema.html">schemas.schema.Schema</a>):</div>
</div>
<div class="foldopen" id="foldopen00057" data-start="" data-end="">
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno"><a class="line" href="namespaceformatron_1_1formats_1_1json.html#a311b750cba3838aee622b9809888f051">   57</a></span>            line = [f<span class="stringliteral">&quot;{nonterminal} ::= &quot;</span>, <span class="stringliteral">&quot;object_begin &quot;</span>]</div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span>            result = []</div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>            fields = []</div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span>            <span class="keywordflow">for</span> field, _field_info <span class="keywordflow">in</span> current.fields().items():</div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>                field_name = f<span class="stringliteral">&quot;{nonterminal}_{field}&quot;</span></div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span>                fields.append(f<span class="stringliteral">&quot;&#39;\&quot;{field}\&quot;&#39; colon {field_name}&quot;</span>)</div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>                result.append((_field_info, field_name))</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>            line.append(<span class="stringliteral">&quot; comma &quot;</span>.join(fields))</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>            line.append(<span class="stringliteral">&quot; object_end;\n&quot;</span>)</div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>            <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>.join(line), result</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>        <span class="keywordflow">return</span> <span class="keywordtype">None</span></div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span> </div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>    <span class="keyword">def </span>field_info(current: typing.Type, nonterminal: str):</div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span>        <span class="keywordflow">if</span> isinstance(current, <a class="code hl_class" href="classformatron_1_1schemas_1_1schema_1_1FieldInfo.html">schemas.schema.FieldInfo</a>):</div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span>            annotation = current.annotation</div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>            <span class="keywordflow">if</span> current.required:</div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>                <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>, [(annotation, nonterminal)]</div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>            new_nonterminal = f<span class="stringliteral">&quot;{nonterminal}_required&quot;</span></div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span>            <span class="keywordflow">return</span> f<span class="stringliteral">&quot;{nonterminal} ::= {new_nonterminal}?;\n&quot;</span>, [(annotation, new_nonterminal)]</div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>        <span class="keywordflow">return</span> <span class="keywordtype">None</span></div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span> </div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>    <span class="keyword">def </span>string_metadata(current: typing.Type, nonterminal: str):</div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>        min_length = current.metadata.get(<span class="stringliteral">&quot;min_length&quot;</span>)</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>        max_length = current.metadata.get(<span class="stringliteral">&quot;max_length&quot;</span>)</div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>        pattern = current.metadata.get(<span class="stringliteral">&quot;pattern&quot;</span>)</div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>        <span class="keywordflow">if</span> pattern:</div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>            <span class="keyword">assert</span> <span class="keywordflow">not</span> (min_length <span class="keywordflow">or</span> max_length), <span class="stringliteral">&quot;pattern is mutually exclusive with min_length and max_length&quot;</span></div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>        repetition_map = {</div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>            (<span class="keyword">True</span>, <span class="keyword">False</span>): f<span class="stringliteral">&quot;{{{min_length},}}&quot;</span>,</div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>            (<span class="keyword">False</span>, <span class="keyword">True</span>): f<span class="stringliteral">&quot;{{0,{max_length}}}&quot;</span>,</div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>            (<span class="keyword">True</span>, <span class="keyword">True</span>): f<span class="stringliteral">&quot;{{{min_length},{max_length}}}&quot;</span></div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>        }</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>        repetition = repetition_map.get((min_length <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>, max_length <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>))</div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>        <span class="keywordflow">if</span> repetition <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>            <span class="keywordflow">return</span> fr<span class="stringliteral">&quot;&quot;&quot;{nonterminal} ::= #&#39;&quot;([^\\\\&quot;\u0000-\u001f]|\\\\[&quot;\\\\bfnrt/]|\\\\u[0-9A-Fa-f]{{4}}){repetition}&quot;&#39;;</span></div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span><span class="stringliteral">&quot;&quot;&quot;</span>, []</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>        <span class="keywordflow">if</span> pattern <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>            pattern = pattern.replace(<span class="stringliteral">&quot;&#39;&quot;</span>, <span class="stringliteral">&quot;\\&#39;&quot;</span>)</div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>            <span class="keywordflow">return</span> f<span class="stringliteral">&quot;&quot;&quot;{nonterminal} ::= #&#39;&quot;{pattern}&quot;&#39;;\n&quot;&quot;&quot;</span>, []</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>    </div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>    <span class="keyword">def </span>number_metadata(current: typing.Type, nonterminal: str):</div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>        gt = current.metadata.get(<span class="stringliteral">&quot;gt&quot;</span>)</div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>        ge = current.metadata.get(<span class="stringliteral">&quot;ge&quot;</span>)</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>        lt = current.metadata.get(<span class="stringliteral">&quot;lt&quot;</span>)</div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>        le = current.metadata.get(<span class="stringliteral">&quot;le&quot;</span>)</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>        </div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>        prefix_map = {</div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>            (gt, 0): <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>            (ge, 0): <span class="stringliteral">&quot;0|&quot;</span>,</div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span>            (lt, 0): <span class="stringliteral">&quot;-&quot;</span>,</div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>            (le, 0): <span class="stringliteral">&quot;0|-&quot;</span>,</div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>        }</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>        </div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>        <span class="keywordflow">for</span> (condition, value), prefix <span class="keywordflow">in</span> prefix_map.items():</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>            <span class="keywordflow">if</span> condition <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span> <span class="keywordflow">and</span> condition == value:</div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>                <span class="keywordflow">if</span> issubclass(current.type, int):</div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>                    <span class="keywordflow">return</span> f<span class="stringliteral">&quot;&quot;&quot;{nonterminal} ::= #&#39;{prefix}[1-9][0-9]*&#39;;\n&quot;&quot;&quot;</span>, []</div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>                <span class="keywordflow">elif</span> issubclass(current.type, float):</div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>                    <span class="keywordflow">return</span> f<span class="stringliteral">&quot;&quot;&quot;{nonterminal} ::= #&#39;{prefix}[1-9][0-9]*(\\.[0-9]+)?([eE][+-]?[0-9]+)?&#39;;\n&quot;&quot;&quot;</span>, []</div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>        </div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span>        <span class="keywordflow">raise</span> ValueError(f<span class="stringliteral">&quot;{current.type.__name__} metadata {current.metadata} is not supported in json_generators!&quot;</span>)</div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>    </div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>    <span class="keyword">def </span>sequence_metadata(current: typing.Type, nonterminal: str):</div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span>        min_items = current.metadata.get(<span class="stringliteral">&quot;min_length&quot;</span>)</div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>        max_items = current.metadata.get(<span class="stringliteral">&quot;max_length&quot;</span>)</div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>        prefix_items = current.metadata.get(<span class="stringliteral">&quot;prefix_items&quot;</span>)</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>        additional_items = current.metadata.get(<span class="stringliteral">&quot;additional_items&quot;</span>)</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>        <span class="keywordflow">if</span> max_items <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span> <span class="keywordflow">and</span> prefix_items <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span> <span class="keywordflow">and</span> max_items &lt;= len(prefix_items): <span class="comment"># truncate prefix items</span></div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>            prefix_items = prefix_items[:max_items+1]</div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span>        <span class="keywordflow">if</span> prefix_items:</div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>            <span class="keywordflow">if</span> <span class="keywordflow">not</span> min_items: <span class="comment"># json schema defaults to 0</span></div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>                min_items = 0</div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span>            <span class="keywordflow">if</span> <span class="keywordflow">not</span> additional_items:</div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>                <span class="keywordflow">if</span> min_items &gt; len(prefix_items):</div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>                    <span class="keywordflow">raise</span> ValueError(f<span class="stringliteral">&quot;min_items {min_items} is greater than the number of prefix_items {len(prefix_items)} and additional_items is not allowed&quot;</span>)</div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>                max_items = len(prefix_items)</div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>        <span class="keywordflow">if</span> min_items <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span> <span class="keywordflow">or</span> max_items <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>: <span class="comment"># prefix items will set min</span></div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>            new_nonterminal = f<span class="stringliteral">&quot;{nonterminal}_item&quot;</span></div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>            ebnf_rules = []</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>            <span class="keywordflow">if</span> min_items <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>                min_items = 0</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>            <span class="keywordflow">if</span> min_items == 0 <span class="keywordflow">and</span> max_items <span class="keywordflow">is</span> <span class="keywordtype">None</span> <span class="keywordflow">and</span> prefix_items <span class="keywordflow">is</span> <span class="keywordtype">None</span>: <span class="comment"># no special handling needed</span></div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>                <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>, [(current.type, new_nonterminal)]</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>            prefix_items_nonterminals = [f<span class="stringliteral">&quot;{new_nonterminal}_{i}&quot;</span> <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(len(prefix_items))] <span class="keywordflow">if</span> prefix_items <span class="keywordflow">else</span> []</div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>            prefix_items_parts = [] <span class="comment"># contains the sequence of nonterminals for prefix items from min_items to len(prefix_items)</span></div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>            <span class="keywordflow">if</span> prefix_items <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>                <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(max(min_items,1), len(prefix_items)+1):</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>                    prefix_items_parts.append(prefix_items_nonterminals[:i])</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>                <span class="keywordflow">if</span> min_items == 0:</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>                    ebnf_rules.append(f<span class="stringliteral">&quot;{nonterminal} ::= array_begin array_end;&quot;</span>)</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>            <span class="keywordflow">if</span> max_items <span class="keywordflow">is</span> <span class="keywordtype">None</span>: <span class="comment"># unbounded</span></div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>                <span class="keywordflow">if</span> <span class="keywordflow">not</span> prefix_items:</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>                    min_items_part = <span class="stringliteral">&#39; comma &#39;</span>.join([new_nonterminal] * (min_items - 1))</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>                    ebnf_rules.append(f<span class="stringliteral">&quot;{nonterminal} ::= array_begin {min_items_part} comma {new_nonterminal}+ array_end;&quot;</span>)</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>                <span class="keywordflow">elif</span> len(prefix_items_parts) &gt;= min_items:</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>                    <span class="keywordflow">for</span> prefix_items_part <span class="keywordflow">in</span> prefix_items_parts:</div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>                        prefix_items_part = <span class="stringliteral">&#39; comma &#39;</span>.join(prefix_items_part)</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>                    ebnf_rules.append(f<span class="stringliteral">&quot;{nonterminal} ::= array_begin {prefix_items_part} (comma {new_nonterminal})* array_end;&quot;</span>)</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>                <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>                    min_items_part = <span class="stringliteral">&#39; comma &#39;</span>.join([new_nonterminal] * (min_items - len(prefix_items_nonterminals)-1))</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>                    <span class="keywordflow">if</span>  min_items_part:</div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>                        min_items_part = <span class="stringliteral">&quot;comma &quot;</span> + min_items_part</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>                    prefix_items_part = <span class="stringliteral">&#39; comma &#39;</span>.join(prefix_items_nonterminals)</div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>                    ebnf_rules.append(f<span class="stringliteral">&quot;{nonterminal} ::= array_begin {prefix_items_part} {min_items_part} comma {new_nonterminal}+ array_end;&quot;</span>)</div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>            <span class="keywordflow">elif</span> min_items == 0 <span class="keywordflow">and</span> <span class="keywordflow">not</span> prefix_items:</div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>                <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(min_items, max_items + 1):</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>                    items = <span class="stringliteral">&#39; comma &#39;</span>.join([new_nonterminal] * i)</div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>                    ebnf_rules.append(f<span class="stringliteral">&quot;{nonterminal} ::= array_begin {items} array_end;&quot;</span>)</div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>            <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>                prefix_items_num = len(prefix_items_nonterminals)</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>                <span class="keywordflow">if</span> prefix_items:</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>                    <span class="keywordflow">for</span> prefix_items_part <span class="keywordflow">in</span> prefix_items_parts:</div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>                        prefix_items_part = <span class="stringliteral">&#39; comma &#39;</span>.join(prefix_items_part)</div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>                        ebnf_rules.append(f<span class="stringliteral">&quot;{nonterminal} ::= array_begin {prefix_items_part} array_end;&quot;</span>)</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>                min_items_part = <span class="stringliteral">&#39; comma &#39;</span>.join([new_nonterminal] * (min_items - prefix_items_num))</div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>                prefix_items_part = <span class="stringliteral">&#39; comma &#39;</span>.join(prefix_items_nonterminals)</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>                <span class="keywordflow">if</span> min_items_part <span class="keywordflow">and</span> prefix_items_part:</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>                    ebnf_rules.append(f<span class="stringliteral">&quot;{nonterminal}_min ::= {prefix_items_part} comma {min_items_part};&quot;</span>)</div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>                <span class="keywordflow">elif</span> min_items_part:</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>                    ebnf_rules.append(f<span class="stringliteral">&quot;{nonterminal}_min ::= {min_items_part};&quot;</span>)</div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>                <span class="keywordflow">elif</span> prefix_items_part:</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>                    ebnf_rules.append(f<span class="stringliteral">&quot;{nonterminal}_min ::= {prefix_items_part};&quot;</span>)</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>                common = max(min_items, prefix_items_num)</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>                <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(1, max_items + 1 - common):</div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>                    items = <span class="stringliteral">&#39; comma &#39;</span>.join([new_nonterminal] * i)</div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>                    ebnf_rules.append(f<span class="stringliteral">&quot;{nonterminal} ::= array_begin {nonterminal}_min comma {items} array_end;&quot;</span>)  </div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>            <span class="comment"># Handle the item type</span></div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>            args = typing.get_args(current.type)</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>            <span class="keywordflow">if</span> args:</div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>                item_type = args[0]</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span>            <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>                <span class="comment"># If args is empty, default to Any</span></div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>                item_type = typing.Any</div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>            <span class="keywordflow">if</span> prefix_items:</div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>                <span class="keywordflow">return</span> <span class="stringliteral">&quot;\n&quot;</span>.join(ebnf_rules) + <span class="stringliteral">&quot;\n&quot;</span>, list(zip(prefix_items, prefix_items_nonterminals)) + [(item_type, new_nonterminal)]</div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>            <span class="keywordflow">return</span> <span class="stringliteral">&quot;\n&quot;</span>.join(ebnf_rules) + <span class="stringliteral">&quot;\n&quot;</span>, [(item_type, new_nonterminal)]</div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>        <span class="keywordflow">return</span> <span class="keywordtype">None</span></div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>    </div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>    <span class="keyword">def </span>is_sequence_like(current: typing.Type) -&gt; bool:</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span><span class="stringliteral">        Check if the given type is sequence-like.</span></div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span><span class="stringliteral">        This function returns True for:</span></div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span><span class="stringliteral">        - typing.Sequence</span></div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span><span class="stringliteral">        - typing.List</span></div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span><span class="stringliteral">        - typing.Tuple</span></div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span><span class="stringliteral">        - Any subclass of collections.abc.Sequence</span></div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span><span class="stringliteral">        - list</span></div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span><span class="stringliteral">        - tuple</span></div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span><span class="stringliteral">        Args:</span></div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span><span class="stringliteral">            current: The type to check.</span></div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span><span class="stringliteral">        Returns:</span></div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span><span class="stringliteral">            bool: True if the type is sequence-like, False otherwise.</span></div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>        original = typing.get_origin(current)</div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>        <span class="keywordflow">if</span> original <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>            original = current</div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>        <span class="keywordflow">return</span> (</div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>            original <span class="keywordflow">is</span> typing.Sequence <span class="keywordflow">or</span></div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>            original <span class="keywordflow">is</span> typing.List <span class="keywordflow">or</span></div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>            original <span class="keywordflow">is</span> typing.Tuple <span class="keywordflow">or</span></div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>            (isinstance(original, type) <span class="keywordflow">and</span> (issubclass(original, collections.abc.Sequence) <span class="keywordflow">or</span></div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>            issubclass(original, list) <span class="keywordflow">or</span></div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>            issubclass(original, tuple)))</div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>        )</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span> </div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>    <span class="keyword">def </span>metadata(current: typing.Type, nonterminal: str):</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>        <span class="keywordflow">if</span> isinstance(current, <a class="code hl_class" href="classformatron_1_1schemas_1_1schema_1_1TypeWithMetadata.html">schemas.schema.TypeWithMetadata</a>):</div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>            original = typing.get_origin(current.type)</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>            <span class="keywordflow">if</span> original <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>                original = current.type</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>            <span class="keywordflow">if</span> <span class="keywordflow">not</span> current.metadata:</div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>                <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>, [(current.type, nonterminal)]</div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>            <span class="keywordflow">if</span> isinstance(current.type, type) <span class="keywordflow">and</span> issubclass(current.type, str):</div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>                <span class="keywordflow">return</span> string_metadata(current, nonterminal)</div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>            <span class="keywordflow">elif</span> isinstance(current.type, type) <span class="keywordflow">and</span> issubclass(current.type, (int, float)):</div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>                <span class="keywordflow">return</span> number_metadata(current, nonterminal)</div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>            <span class="keywordflow">elif</span> is_sequence_like(original):</div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>                <span class="keywordflow">return</span> sequence_metadata(current, nonterminal)</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>        <span class="keywordflow">return</span> <span class="keywordtype">None</span></div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span> </div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span>    <span class="keyword">def </span>builtin_sequence(current: typing.Type, nonterminal: str):</div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>        original = typing.get_origin(current)</div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>        <span class="keywordflow">if</span> original <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>            original = current</div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>        <span class="keywordflow">if</span> is_sequence_like(original):</div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>            new_nonterminal = f<span class="stringliteral">&quot;{nonterminal}_value&quot;</span></div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>            annotation = typing.get_args(current)</div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span>            <span class="keywordflow">if</span> <span class="keywordflow">not</span> annotation:</div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span>                annotation = typing.Any</div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>            <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>                annotation = annotation[0]</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>            <span class="keywordflow">return</span> f<span class="stringliteral">&quot;{nonterminal} ::= array_begin ({new_nonterminal} (comma {new_nonterminal})*)? array_end;\n&quot;</span>, \</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span>                [(annotation, new_nonterminal)]</div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span>        <span class="keywordflow">return</span> <span class="keywordtype">None</span></div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span> </div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>    <span class="keyword">def </span>builtin_dict(current: typing.Type, nonterminal: str):</div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>        original = typing.get_origin(current)</div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>        <span class="keywordflow">if</span> original <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>            original = current</div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>        <span class="keywordflow">if</span> original <span class="keywordflow">is</span> typing.Mapping <span class="keywordflow">or</span> isinstance(original, type) <span class="keywordflow">and</span> issubclass(original,</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>                                                                                   collections.abc.Mapping):</div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>            new_nonterminal = f<span class="stringliteral">&quot;{nonterminal}_value&quot;</span></div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>            args = typing.get_args(current)</div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>            <span class="keywordflow">if</span> <span class="keywordflow">not</span> args:</div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>                value = typing.Any</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>            <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span>                <span class="keyword">assert</span> issubclass(</div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>                    args[0], str), f<span class="stringliteral">&quot;{args[0]} is not string!&quot;</span></div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>                value = args[1]</div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>            <span class="keywordflow">return</span> f<span class="stringliteral">&quot;{nonterminal} ::=&quot;</span> \</div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>                f<span class="stringliteral">&quot; object_begin (string colon {new_nonterminal} (comma string colon {new_nonterminal})*)?&quot;</span> \</div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>                f<span class="stringliteral">&quot; object_end;\n&quot;</span>, \</div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>                [(value, new_nonterminal)]</div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>        <span class="keywordflow">return</span> <span class="keywordtype">None</span></div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span> </div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>    <span class="keyword">def </span>builtin_tuple(current: typing.Type, nonterminal: str):</div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>        <span class="keywordflow">if</span> typing.get_origin(current) <span class="keywordflow">is</span> tuple <span class="keywordflow">or</span> isinstance(current, type) <span class="keywordflow">and</span> issubclass(current, tuple):</div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span>            args = typing.get_args(current)</div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>            new_nonterminals = []</div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>            result = []</div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>            <span class="keywordflow">for</span> i, arg <span class="keywordflow">in</span> enumerate(args):</div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span>                result.append(arg)</div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>                new_nonterminals.append(f<span class="stringliteral">&quot;{nonterminal}_{i}&quot;</span>)</div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>            <span class="keywordflow">return</span> f<span class="stringliteral">&quot;{nonterminal} ::=array_begin {&#39; comma &#39;.join(new_nonterminals)} array_end;\n&quot;</span>, \</div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span>                zip(result, new_nonterminals)</div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span> </div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>    <span class="keyword">def </span>builtin_union(current: typing.Type, nonterminal: str):</div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span>        <span class="keywordflow">if</span> typing.get_origin(current) <span class="keywordflow">is</span> typing.Union:</div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span>            args = typing.get_args(current)</div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span>            <span class="keyword">assert</span> args, f<span class="stringliteral">&quot;{current} from {nonterminal} cannot be an empty union!&quot;</span></div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>            new_nonterminals = []</div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span>            result = []</div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span>            <span class="keywordflow">for</span> i, arg <span class="keywordflow">in</span> enumerate(args):</div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>                result.append(arg)</div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span>                new_nonterminals.append(f<span class="stringliteral">&quot;{nonterminal}_{i}&quot;</span>)</div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>            <span class="keywordflow">return</span> f<span class="stringliteral">&quot;{nonterminal} ::= {&#39; | &#39;.join(new_nonterminals)};\n&quot;</span>, zip(result, new_nonterminals)</div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span> </div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>    <span class="keyword">def </span>builtin_literal(current: typing.Type, nonterminal: str):</div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>        <span class="keywordflow">if</span> typing.get_origin(current) <span class="keywordflow">is</span> typing.Literal:</div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>            args = typing.get_args(current)</div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span>            <span class="keyword">assert</span> args, f<span class="stringliteral">&quot;{current} from {nonterminal} cannot be an empty literal!&quot;</span></div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span>            new_items = []</div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span>            result = []</div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>            <span class="keywordflow">for</span> i, arg <span class="keywordflow">in</span> enumerate(args):</div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>                <span class="keywordflow">if</span> isinstance(arg, str):</div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>                    new_items.append(f<span class="stringliteral">&#39;&quot;\\&quot;{repr(arg)[1:-1]}\\&quot;&quot;&#39;</span>)</div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>                <span class="keywordflow">elif</span> isinstance(arg, bool):</div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>                    new_items.append(f<span class="stringliteral">&#39;&quot;{str(arg).lower()}&quot;&#39;</span>)</div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>                <span class="keywordflow">elif</span> isinstance(arg, int):</div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span>                    new_items.append(f<span class="stringliteral">&#39;&quot;{str(arg)}&quot;&#39;</span>)</div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>                <span class="keywordflow">elif</span> isinstance(arg, float):</div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span>                    new_items.append(f<span class="stringliteral">&#39;&quot;{str(arg)}&quot;&#39;</span>)</div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>                <span class="keywordflow">elif</span> arg <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span>                    new_items.append(<span class="stringliteral">&quot;null&quot;</span>)</div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span>                <span class="keywordflow">elif</span> isinstance(arg, tuple):</div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span>                    <span class="keywordflow">for</span> j,item <span class="keywordflow">in</span> enumerate(arg):</div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>                        new_nonterminal = f<span class="stringliteral">&quot;{nonterminal}_{i}_{j}&quot;</span></div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span>                        result.append((typing.Literal[item], new_nonterminal))</div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span>                    new_item = f<span class="stringliteral">&quot;(array_begin {&#39; comma &#39;.join(map(lambda x:x[1], result))} array_end)&quot;</span></div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span>                    new_items.append(new_item)</div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span>                <span class="keywordflow">elif</span> isinstance(arg, frozendict):</div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span>                    <span class="keywordflow">for</span> key, value <span class="keywordflow">in</span> arg.items():</div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span>                        new_nonterminal = f<span class="stringliteral">&quot;{nonterminal}_{i}_{key}&quot;</span></div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span>                        result.append((typing.Literal[value], new_nonterminal))</div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span>                    new_item = f<span class="stringliteral">&quot;object_begin {&#39; comma &#39;.join(map(lambda x:x[1], result))} object_end&quot;</span></div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>                    new_items.append(new_item)</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>                <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span>                    new_nonterminal = f<span class="stringliteral">&quot;{nonterminal}_{i}&quot;</span></div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>                    result.append((arg, new_nonterminal))</div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>                    new_items.append(new_nonterminal)</div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span>            <span class="keywordflow">return</span> f<span class="stringliteral">&quot;{nonterminal} ::= {&#39; | &#39;.join(new_items)};\n&quot;</span>, result</div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span> </div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>    <span class="keyword">def </span>builtin_simple_types(current: typing.Type, nonterminal: str):</div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>        <span class="keywordflow">if</span> isinstance(current, type) <span class="keywordflow">and</span> issubclass(current, bool):</div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span>            <span class="keywordflow">return</span> f<span class="stringliteral">&quot;{nonterminal} ::= boolean;\n&quot;</span>, []</div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span>        <span class="keywordflow">elif</span> isinstance(current, type) <span class="keywordflow">and</span> issubclass(current, int):</div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>            <span class="keywordflow">return</span> f<span class="stringliteral">&quot;{nonterminal} ::= integer;\n&quot;</span>, []</div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span>        <span class="keywordflow">elif</span> isinstance(current, type) <span class="keywordflow">and</span> issubclass(current, float):</div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span>            <span class="keywordflow">return</span> f<span class="stringliteral">&quot;{nonterminal} ::= number;\n&quot;</span>, []</div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>        <span class="keywordflow">elif</span> isinstance(current, type) <span class="keywordflow">and</span> issubclass(current, decimal.Decimal):</div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>            <span class="keywordflow">return</span> f<span class="stringliteral">&quot;{nonterminal} ::= number;\n&quot;</span>, []</div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span>        <span class="keywordflow">elif</span> isinstance(current, type) <span class="keywordflow">and</span> issubclass(current, str):</div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span>            <span class="keywordflow">return</span> f<span class="stringliteral">&quot;{nonterminal} ::= string;\n&quot;</span>, []</div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span>        <span class="keywordflow">elif</span> isinstance(current, type) <span class="keywordflow">and</span> issubclass(current, type(<span class="keywordtype">None</span>)):</div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span>            <span class="keywordflow">return</span> f<span class="stringliteral">&quot;{nonterminal} ::= null;\n&quot;</span>, []</div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span>        <span class="keywordflow">elif</span> current <span class="keywordflow">is</span> typing.Any:</div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>            <span class="keywordflow">return</span> f<span class="stringliteral">&quot;{nonterminal} ::= json_value;\n&quot;</span>, []</div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span>        <span class="keywordflow">elif</span> isinstance(current, typing.NewType):</div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span>            current: typing.NewType</div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span>            <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>, [(current.__supertype__, nonterminal)]</div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span> </div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>    <a class="code hl_function" href="namespaceformatron_1_1formats_1_1json.html#a55ae1cd2ef251d160e872a0c49e7ba7a">register_generate_nonterminal_def</a>(builtin_simple_types)</div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span>    <a class="code hl_function" href="namespaceformatron_1_1formats_1_1json.html#a55ae1cd2ef251d160e872a0c49e7ba7a">register_generate_nonterminal_def</a>(schema)</div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span>    <a class="code hl_function" href="namespaceformatron_1_1formats_1_1json.html#a55ae1cd2ef251d160e872a0c49e7ba7a">register_generate_nonterminal_def</a>(field_info)</div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>    <a class="code hl_function" href="namespaceformatron_1_1formats_1_1json.html#a55ae1cd2ef251d160e872a0c49e7ba7a">register_generate_nonterminal_def</a>(metadata)</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>    <a class="code hl_function" href="namespaceformatron_1_1formats_1_1json.html#a55ae1cd2ef251d160e872a0c49e7ba7a">register_generate_nonterminal_def</a>(builtin_tuple)</div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span>    <a class="code hl_function" href="namespaceformatron_1_1formats_1_1json.html#a55ae1cd2ef251d160e872a0c49e7ba7a">register_generate_nonterminal_def</a>(builtin_literal)</div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>    <a class="code hl_function" href="namespaceformatron_1_1formats_1_1json.html#a55ae1cd2ef251d160e872a0c49e7ba7a">register_generate_nonterminal_def</a>(builtin_union)</div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span>    <a class="code hl_function" href="namespaceformatron_1_1formats_1_1json.html#a55ae1cd2ef251d160e872a0c49e7ba7a">register_generate_nonterminal_def</a>(builtin_sequence)</div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span>    <a class="code hl_function" href="namespaceformatron_1_1formats_1_1json.html#a55ae1cd2ef251d160e872a0c49e7ba7a">register_generate_nonterminal_def</a>(builtin_dict)</div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span> </div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span><span class="keyword">def </span><a class="code hl_function" href="namespaceformatron_1_1formats_1_1json.html#af4331f1a7679439503d898b2356d289e">_generate_kbnf_grammar</a>(schema: schemas.schema.Schema|collections.abc.Sequence, start_nonterminal: str) -&gt; str:</div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span><span class="stringliteral">    Generate a KBNF grammar string from a schema for JSON format.</span></div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span><span class="stringliteral">    Args:</span></div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span><span class="stringliteral">        schema: The schema to generate a grammar for.</span></div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span><span class="stringliteral">        start_nonterminal: The start nonterminal of the grammar. Default is &quot;start&quot;.</span></div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span><span class="stringliteral"></span> </div>
</div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span><span class="stringliteral">    Returns:</span></div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span><span class="stringliteral">        The generated KBNF grammar string.</span></div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span>    type_id_to_nonterminal = {</div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span>        id(int): <span class="stringliteral">&quot;integer&quot;</span>,</div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span>        id(float): <span class="stringliteral">&quot;number&quot;</span>,</div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span>        id(str): <span class="stringliteral">&quot;string&quot;</span>,</div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span>        id(bool): <span class="stringliteral">&quot;boolean&quot;</span>,</div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>        id(type(<span class="keywordtype">None</span>)): <span class="stringliteral">&quot;null&quot;</span>,</div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span>        id(list): <span class="stringliteral">&quot;array&quot;</span>,</div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span>        id(dict): <span class="stringliteral">&quot;object&quot;</span>,</div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>        id(typing.Any): <span class="stringliteral">&quot;json_value&quot;</span>,</div>
<div class="foldopen" id="foldopen00381" data-start="" data-end="">
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno"><a class="line" href="namespaceformatron_1_1formats_1_1json.html#af4331f1a7679439503d898b2356d289e">  381</a></span>    }</div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span>    result = [GRAMMAR_HEADER]</div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span>    nonterminals = set()</div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>    stack = [(schema, start_nonterminal)]</div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>    <span class="keywordflow">while</span> stack:</div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span>        (current, nonterminal) = stack.pop()</div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>        type_id = id(current)</div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>        <span class="keywordflow">if</span> type_id <span class="keywordflow">in</span> type_id_to_nonterminal:</div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span>            line = f<span class="stringliteral">&quot;{nonterminal} ::= {type_id_to_nonterminal[type_id]};\n&quot;</span></div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span>            result.append(line)</div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span>            <span class="keywordflow">continue</span></div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span>        type_id_to_nonterminal[type_id] = nonterminal</div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span>        <span class="keywordflow">for</span> i <span class="keywordflow">in</span> _type_to_nonterminals:</div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span>            value = i(current, nonterminal)</div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span>            <span class="keywordflow">if</span> value <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>                line, to_stack = value</div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span>                result.append(line)</div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span>                stack.extend(to_stack)</div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span>                nonterminals.add(nonterminal)</div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span>                <span class="keywordflow">break</span></div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span>            <span class="keywordflow">raise</span> TypeError(</div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span>                f<span class="stringliteral">&quot;{current} from {nonterminal} is not supported in json_generators!&quot;</span>)</div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span>    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>.join(result)</div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span> </div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span> </div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span><span class="keyword">class </span><a class="code hl_class" href="classformatron_1_1formats_1_1json_1_1JsonExtractor.html">JsonExtractor</a>(<a class="code hl_class" href="classformatron_1_1extractor_1_1NonterminalExtractor.html">extractor.NonterminalExtractor</a>):</div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span><span class="stringliteral">    An extractor that loads json data to an object from a string.</span></div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span> </div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span>    <span class="keyword">def </span>__init__(self, nonterminal: str, capture_name: typing.Optional[str], schema: <a class="code hl_class" href="classformatron_1_1schemas_1_1schema_1_1Schema.html">schemas.schema.Schema</a>|collections.abc.Sequence,</div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span>                 to_object: typing.Callable[[str], <a class="code hl_class" href="classformatron_1_1schemas_1_1schema_1_1Schema.html">schemas.schema.Schema</a>]):</div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span><span class="stringliteral">        Create a json extractor from a given schema or a list of supported types.</span></div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span><span class="stringliteral"></span> </div>
</div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span><span class="stringliteral">        Currently, the following data types are supported:</span></div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span><span class="stringliteral">        - bool</span></div>
<div class="foldopen" id="foldopen00420" data-start="" data-end="">
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno"><a class="line" href="classformatron_1_1formats_1_1json_1_1JsonExtractor.html">  420</a></span><span class="stringliteral">        - int</span></div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span><span class="stringliteral">          - positive int</span></div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span><span class="stringliteral">          - negative int</span></div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span><span class="stringliteral">          - nonnegative int</span></div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span><span class="stringliteral">          - nonpositive int</span></div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span><span class="stringliteral">        - float</span></div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span><span class="stringliteral">          - positive float</span></div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span><span class="stringliteral">          - negative float</span></div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span><span class="stringliteral">          - nonnegative float</span></div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span><span class="stringliteral">          - nonpositive float</span></div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span><span class="stringliteral">        - str</span></div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span><span class="stringliteral">          - optionally with min_length, max_length and pattern constraints</span></div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span><span class="stringliteral">            - length is measured in UTF-8 character number after json parsing</span></div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span><span class="stringliteral">            - *Warning*: too large difference between min_length and max_length can lead to enormous memory consumption!</span></div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span><span class="stringliteral">            - pattern is mutually exclusive with min_length and max_length</span></div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span><span class="stringliteral">            - pattern will be compiled to a regular expression so all caveats of regular expressions apply</span></div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span><span class="stringliteral">            - pattern currently is automatically anchored at both ends</span></div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span><span class="stringliteral">            - the generated json could be invalid if the pattern allows invalid content between the json string&#39;s quotes.</span></div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span><span class="stringliteral">              - for example, `pattern=&quot;.*&quot;` will allow &#39;\&quot;&#39; to appear in the json string which is forbidden by JSON standard.</span></div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span><span class="stringliteral">        - NoneType</span></div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span><span class="stringliteral">        - typing.Any</span></div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span><span class="stringliteral">        - Subclasses of collections.abc.Mapping[str,T] and typing.Mapping[str,T] where T is a supported type,</span></div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span><span class="stringliteral">        - Subclasses of collections.abc.Sequence[T] and typing.Sequence[T] where T is a supported type.</span></div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span><span class="stringliteral">          - optionally with `minItems`, `maxItems`, `prefixItems` constraints</span></div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span><span class="stringliteral">          - *Warning*: too large difference between minItems and maxItems can lead to very slow performance!</span></div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span><span class="stringliteral">          - *Warning*: By json schema definition, prefixItems by default allows additional items and missing items in the prefixItems, which may not be the desired behavior and can lead to very slow performance if prefixItems is long!</span></div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span><span class="stringliteral">        - tuple[T1,T2,...] where T1,T2,... are supported types. The order, type and number of elements will be preserved.</span></div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span><span class="stringliteral">        - typing.Literal[x1,x2,...] where x1, x2, ... are instances of int, string, bool or NoneType, or another typing.Literal[y1,y2,...]</span></div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span><span class="stringliteral">        - typing.Union[T1,T2,...] where T1,T2,... are supported types.</span></div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span><span class="stringliteral">        - schemas.Schema where all its fields&#39; data types are supported. Recursive schema definitions are supported as well.</span></div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span><span class="stringliteral">          - *Warning*: while not required field is supported, they can lead to very slow performance and/or enormous memory consumption if there are too many of them!</span></div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span><span class="stringliteral">        Args:</span></div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span><span class="stringliteral">            nonterminal: The nonterminal representing the extractor.</span></div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span><span class="stringliteral">            capture_name: The capture name of the extractor, or `None` if the extractor does not capture.</span></div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span><span class="stringliteral">            to_object: A callable to convert the extracted string to a schema instance.</span></div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span>        super().<a class="code hl_function" href="classformatron_1_1formats_1_1json_1_1JsonExtractor.html#a7a51edd3cc7c24370c809d91e07771dc">__init__</a>(nonterminal, capture_name)</div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span>        self.<a class="code hl_variable" href="classformatron_1_1formats_1_1json_1_1JsonExtractor.html#a2e72d806c8dffc0136231b81eb724355">_to_object</a> = to_object</div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span>        self.<a class="code hl_variable" href="classformatron_1_1formats_1_1json_1_1JsonExtractor.html#aecf88428e414da080f11ed0ab1e13a65">_rule_str</a> = <a class="code hl_function" href="namespaceformatron_1_1formats_1_1json.html#af4331f1a7679439503d898b2356d289e">_generate_kbnf_grammar</a>(schema, self.<a class="code hl_function" href="classformatron_1_1extractor_1_1NonterminalExtractor.html#a1dd1fabcef2e668d00bf6ebb38dd017f">nonterminal</a>)</div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span>    <span class="keyword">def </span><a class="code hl_function" href="classformatron_1_1formats_1_1json_1_1JsonExtractor.html#a6ad701c17988fe32b164135ebd39c783">extract</a>(self, input_str: str) -&gt; typing.Optional[tuple[str, <a class="code hl_class" href="classformatron_1_1schemas_1_1schema_1_1Schema.html">schemas.schema.Schema</a>]]:</div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span><span class="stringliteral">        Extract a schema instance from a string.</span></div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span><span class="stringliteral">        Args:</span></div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span><span class="stringliteral">            input_str: The input string to extract from.</span></div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span><span class="stringliteral">        Returns:</span></div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span><span class="stringliteral">            A tuple of the remaining string and the extracted schema instance, or `None` if extraction failed.</span></div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span> </div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span>        <span class="comment"># Ensure the input string starts with &#39;{&#39; or &#39;[&#39; after stripping leading whitespace</span></div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span>        input_str = input_str.lstrip()</div>
<div class="foldopen" id="foldopen00472" data-start="" data-end="">
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno"><a class="line" href="classformatron_1_1formats_1_1json_1_1JsonExtractor.html#a7a51edd3cc7c24370c809d91e07771dc">  472</a></span>        <span class="keywordflow">if</span> <span class="keywordflow">not</span> input_str.startswith((<span class="stringliteral">&#39;{&#39;</span>, <span class="stringliteral">&#39;[&#39;</span>)):</div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span>            <span class="keywordflow">return</span> <span class="keywordtype">None</span></div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span> </div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno"><a class="line" href="classformatron_1_1formats_1_1json_1_1JsonExtractor.html#a2e72d806c8dffc0136231b81eb724355">  475</a></span>        <span class="comment"># Variables to track the balance of brackets and the position in the string</span></div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno"><a class="line" href="classformatron_1_1formats_1_1json_1_1JsonExtractor.html#aecf88428e414da080f11ed0ab1e13a65">  476</a></span>        bracket_count = 0</div>
</div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span>        position = 0</div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span>        in_string = <span class="keyword">False</span></div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span>        escape_next = <span class="keyword">False</span></div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span>        start_char = input_str[0]</div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span>        end_char = <span class="stringliteral">&#39;}&#39;</span> <span class="keywordflow">if</span> start_char == <span class="stringliteral">&#39;{&#39;</span> <span class="keywordflow">else</span> <span class="stringliteral">&#39;]&#39;</span></div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span> </div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span>        <span class="comment"># Iterate over the string to find where the JSON object or array ends</span></div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span>        <span class="keywordflow">for</span> char <span class="keywordflow">in</span> input_str:</div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span>            <span class="keywordflow">if</span> <span class="keywordflow">not</span> in_string:</div>
<div class="foldopen" id="foldopen00486" data-start="" data-end="">
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno"><a class="line" href="classformatron_1_1formats_1_1json_1_1JsonExtractor.html#a6ad701c17988fe32b164135ebd39c783">  486</a></span>                <span class="keywordflow">if</span> char == start_char:</div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span>                    bracket_count += 1</div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span>                <span class="keywordflow">elif</span> char == end_char:</div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span>                    bracket_count -= 1</div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span>                <span class="keywordflow">elif</span> char == <span class="stringliteral">&#39;&quot;&#39;</span>:</div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span>                    in_string = <span class="keyword">True</span></div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span>            <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span>                <span class="keywordflow">if</span> char == <span class="stringliteral">&#39;&quot;&#39;</span> <span class="keywordflow">and</span> <span class="keywordflow">not</span> escape_next:</div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span>                    in_string = <span class="keyword">False</span></div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span>                <span class="keywordflow">elif</span> char == <span class="stringliteral">&#39;\\&#39;</span>:</div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span>                    escape_next = <span class="keywordflow">not</span> escape_next</div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span>                <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span>                    escape_next = <span class="keyword">False</span></div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span> </div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span>            <span class="comment"># Move to the next character</span></div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span>            position += 1</div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span> </div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span>            <span class="comment"># If brackets are balanced and we&#39;re not in a string, stop processing</span></div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span>            <span class="keywordflow">if</span> bracket_count == 0 <span class="keywordflow">and</span> <span class="keywordflow">not</span> in_string:</div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span>                <span class="keywordflow">break</span></div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span>            <span class="keywordflow">return</span> <span class="keywordtype">None</span></div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span>        <span class="comment"># The position now points to the character after the last &#39;}&#39;, so we slice to position</span></div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span>        json_str = input_str[:position]</div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span>        remaining_str = input_str[position:]</div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span>        <span class="comment"># Return the unparsed remainder of the string and the decoded JSON object</span></div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span>        <span class="keywordflow">return</span> remaining_str, self.<a class="code hl_variable" href="classformatron_1_1formats_1_1json_1_1JsonExtractor.html#a2e72d806c8dffc0136231b81eb724355">_to_object</a>(json_str)</div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span> </div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span>    <span class="preprocessor">@property</span></div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span>    <span class="keyword">def </span><a class="code hl_function" href="classformatron_1_1formats_1_1json_1_1JsonExtractor.html#ace660f78408893ab8fb7facd410a9d60">kbnf_definition</a>(self):</div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span>        <span class="keywordflow">return</span> self.<a class="code hl_variable" href="classformatron_1_1formats_1_1json_1_1JsonExtractor.html#aecf88428e414da080f11ed0ab1e13a65">_rule_str</a></div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span> </div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span> </div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span><a class="code hl_function" href="namespaceformatron_1_1formats_1_1json.html#a311b750cba3838aee622b9809888f051">_register_all_predefined_types</a>()</div>
</div>
</div>
<div class="ttc" id="aclassformatron_1_1extractor_1_1NonterminalExtractor_html"><div class="ttname"><a href="classformatron_1_1extractor_1_1NonterminalExtractor.html">formatron.extractor.NonterminalExtractor</a></div><div class="ttdoc">An extractor that extracts data corresponding to a nonterminal.</div><div class="ttdef"><b>Definition</b> <a href="extractor_8py_source.html#l00098">extractor.py:98</a></div></div>
<div class="ttc" id="aclassformatron_1_1extractor_1_1NonterminalExtractor_html_a1dd1fabcef2e668d00bf6ebb38dd017f"><div class="ttname"><a href="classformatron_1_1extractor_1_1NonterminalExtractor.html#a1dd1fabcef2e668d00bf6ebb38dd017f">formatron.extractor.NonterminalExtractor.nonterminal</a></div><div class="ttdeci">str nonterminal(self)</div><div class="ttdoc">Get the nonterminal of the extractor.</div><div class="ttdef"><b>Definition</b> <a href="extractor_8py_source.html#l00121">extractor.py:121</a></div></div>
<div class="ttc" id="aclassformatron_1_1formats_1_1json_1_1JsonExtractor_html"><div class="ttname"><a href="classformatron_1_1formats_1_1json_1_1JsonExtractor.html">formatron.formats.json.JsonExtractor</a></div><div class="ttdoc">An extractor that loads json data to an object from a string.</div><div class="ttdef"><b>Definition</b> <a href="#l00420">json.py:420</a></div></div>
<div class="ttc" id="aclassformatron_1_1formats_1_1json_1_1JsonExtractor_html_a2e72d806c8dffc0136231b81eb724355"><div class="ttname"><a href="classformatron_1_1formats_1_1json_1_1JsonExtractor.html#a2e72d806c8dffc0136231b81eb724355">formatron.formats.json.JsonExtractor._to_object</a></div><div class="ttdeci">_to_object</div><div class="ttdef"><b>Definition</b> <a href="#l00475">json.py:475</a></div></div>
<div class="ttc" id="aclassformatron_1_1formats_1_1json_1_1JsonExtractor_html_a6ad701c17988fe32b164135ebd39c783"><div class="ttname"><a href="classformatron_1_1formats_1_1json_1_1JsonExtractor.html#a6ad701c17988fe32b164135ebd39c783">formatron.formats.json.JsonExtractor.extract</a></div><div class="ttdeci">typing.Optional[tuple[str, schemas.schema.Schema]] extract(self, str input_str)</div><div class="ttdoc">Extract a schema instance from a string.</div><div class="ttdef"><b>Definition</b> <a href="#l00486">json.py:486</a></div></div>
<div class="ttc" id="aclassformatron_1_1formats_1_1json_1_1JsonExtractor_html_a7a51edd3cc7c24370c809d91e07771dc"><div class="ttname"><a href="classformatron_1_1formats_1_1json_1_1JsonExtractor.html#a7a51edd3cc7c24370c809d91e07771dc">formatron.formats.json.JsonExtractor.__init__</a></div><div class="ttdeci">__init__(self, str nonterminal, typing.Optional[str] capture_name, schemas.schema.Schema|collections.abc.Sequence schema, typing.Callable[[str], schemas.schema.Schema] to_object)</div><div class="ttdoc">Create a json extractor from a given schema or a list of supported types.</div><div class="ttdef"><b>Definition</b> <a href="#l00472">json.py:473</a></div></div>
<div class="ttc" id="aclassformatron_1_1formats_1_1json_1_1JsonExtractor_html_ace660f78408893ab8fb7facd410a9d60"><div class="ttname"><a href="classformatron_1_1formats_1_1json_1_1JsonExtractor.html#ace660f78408893ab8fb7facd410a9d60">formatron.formats.json.JsonExtractor.kbnf_definition</a></div><div class="ttdeci">kbnf_definition(self)</div><div class="ttdef"><b>Definition</b> <a href="#l00540">json.py:540</a></div></div>
<div class="ttc" id="aclassformatron_1_1formats_1_1json_1_1JsonExtractor_html_aecf88428e414da080f11ed0ab1e13a65"><div class="ttname"><a href="classformatron_1_1formats_1_1json_1_1JsonExtractor.html#aecf88428e414da080f11ed0ab1e13a65">formatron.formats.json.JsonExtractor._rule_str</a></div><div class="ttdeci">_rule_str</div><div class="ttdef"><b>Definition</b> <a href="#l00476">json.py:476</a></div></div>
<div class="ttc" id="aclassformatron_1_1schemas_1_1schema_1_1FieldInfo_html"><div class="ttname"><a href="classformatron_1_1schemas_1_1schema_1_1FieldInfo.html">formatron.schemas.schema.FieldInfo</a></div><div class="ttdef"><b>Definition</b> <a href="schema_8py_source.html#l00009">schema.py:9</a></div></div>
<div class="ttc" id="aclassformatron_1_1schemas_1_1schema_1_1Schema_html"><div class="ttname"><a href="classformatron_1_1schemas_1_1schema_1_1Schema.html">formatron.schemas.schema.Schema</a></div><div class="ttdoc">An abstract schema that describes some data.</div><div class="ttdef"><b>Definition</b> <a href="schema_8py_source.html#l00078">schema.py:78</a></div></div>
<div class="ttc" id="aclassformatron_1_1schemas_1_1schema_1_1TypeWithMetadata_html"><div class="ttname"><a href="classformatron_1_1schemas_1_1schema_1_1TypeWithMetadata.html">formatron.schemas.schema.TypeWithMetadata</a></div><div class="ttdef"><b>Definition</b> <a href="schema_8py_source.html#l00044">schema.py:44</a></div></div>
<div class="ttc" id="anamespaceformatron_1_1formats_1_1json_html_a311b750cba3838aee622b9809888f051"><div class="ttname"><a href="namespaceformatron_1_1formats_1_1json.html#a311b750cba3838aee622b9809888f051">formatron.formats.json._register_all_predefined_types</a></div><div class="ttdeci">_register_all_predefined_types()</div><div class="ttdef"><b>Definition</b> <a href="#l00057">json.py:57</a></div></div>
<div class="ttc" id="anamespaceformatron_1_1formats_1_1json_html_a55ae1cd2ef251d160e872a0c49e7ba7a"><div class="ttname"><a href="namespaceformatron_1_1formats_1_1json.html#a55ae1cd2ef251d160e872a0c49e7ba7a">formatron.formats.json.register_generate_nonterminal_def</a></div><div class="ttdeci">None register_generate_nonterminal_def(typing.Callable[[typing.Type, str], typing.Optional[typing.Tuple[str, typing.List[typing.Tuple[typing.Type, str]]]]] generate_nonterminal_def)</div><div class="ttdoc">Register a callable to generate nonterminal definition from a type.</div><div class="ttdef"><b>Definition</b> <a href="#l00049">json.py:53</a></div></div>
<div class="ttc" id="anamespaceformatron_1_1formats_1_1json_html_af4331f1a7679439503d898b2356d289e"><div class="ttname"><a href="namespaceformatron_1_1formats_1_1json.html#af4331f1a7679439503d898b2356d289e">formatron.formats.json._generate_kbnf_grammar</a></div><div class="ttdeci">str _generate_kbnf_grammar(schemas.schema.Schema|collections.abc.Sequence schema, str start_nonterminal)</div><div class="ttdoc">Generate a KBNF grammar string from a schema for JSON format.</div><div class="ttdef"><b>Definition</b> <a href="#l00381">json.py:381</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_fcf8421df2b1fac2914241030b544a7c.html">formatron</a></li><li class="navelem"><a class="el" href="dir_07d5411bfb9a2f8bc3eb64bb16ab190f.html">formats</a></li><li class="navelem"><a class="el" href="json_8py.html">json.py</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.11.0 </li>
  </ul>
</div>
</body>
</html>
